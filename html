<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ordem de Turno — RPG</title>
  <style>
    :root{
      --bg: #0f1220;
      --panel: #171b2e;
      --panel-2: #1f2440;
      --text: #eef2ff;
      --muted: #cbd5e1;
      --primary: #7c5cff;
      --accent: #22d3ee;
      --danger: #ef4444;
      --ok: #22c55e;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    body{
      margin:0; font-family: sans-serif;
      color: var(--text); background: var(--bg);
      display:flex; justify-content: center;
      padding: 24px;
    }
    .app{width: 100%; max-width: 980px; display:grid; gap: 16px;}
    button{
      appearance:none; border:none; color: var(--text); background: var(--panel-2);
      padding: 6px 10px; border-radius: 8px; cursor: pointer; box-shadow: var(--shadow);
    }
    .btn-primary{ background: var(--primary); }
    .btn-next{ background: var(--accent); color: #000; }
    .btn-end{ background: var(--danger); }
    .btn-ghost{ background: transparent; outline: 1px solid #2a325b; }
    .panel{ background: var(--panel); border-radius: var(--radius); padding: 16px; box-shadow: var(--shadow); }
    .form{ display:flex; gap: 8px; }
    input{ background: #0d1020; color: var(--text); border: 1px solid #2a325b; padding: 6px; border-radius: 6px; }
    ol.player-list{ list-style:none; margin:0; padding:0; display:flex; flex-direction: column; gap: 8px; }
    .player{ display:grid; grid-template-columns: 1fr auto auto auto auto; gap: 6px; align-items:center; padding: 8px; border: 1px solid #2a325b; border-radius: 8px; background: #0d1020; }
    .player.current{ outline: 2px solid var(--accent); }
    .hp-control{ display:flex; align-items:center; gap:4px; }
    .hp-control input{ width: 50px; text-align:center; }
    .cond-control{ display:flex; gap:4px; flex-wrap: wrap; }
    .cond-tag{ background: var(--muted); color:#000; border-radius:4px; padding:2px 6px; font-size:12px; }
    .cond-input{ width:100px; }
    .name-input{ background: transparent; border:none; color: var(--text); font-weight: bold; width:100%; }
    .name-input:focus{ outline: 1px solid var(--accent); background:#1a1f39; }
    .initiative-display{ font-size: 14px; color: var(--muted); margin-right: 6px; }
    .round-indicator{ margin-top: 8px; font-weight: bold; color: var(--accent); }
  </style>
</head>
<body>
  <main class="app">
    <header class="header">
      <div class="title">⚔️ Ordem de Turno — RPG</div>
      <div class="controls">
        <button id="btnStart" class="btn-primary">Começar</button>
        <button id="btnNext" class="btn-next" disabled>Próximo Turno ▶</button>
        <button id="btnEnd" class="btn-end" disabled>Encerrar</button>
        <button id="btnResort" class="btn-ghost" disabled>Reordenar</button>
      </div>
    </header>

    <section class="panel form">
      <input id="name" type="text" placeholder="Nome" />
      <input id="init" type="number" placeholder="Iniciativa" />
      <button id="btnAdd">+ Adicionar</button>
    </section>

    <section class="panel">
      <ol id="playerList" class="player-list"></ol>
      <div id="emptyState">Nenhum jogador ainda. Adicione acima e clique em <b>Começar</b>.</div>
      <div id="roundIndicator" class="round-indicator" style="display:none;">Rodada 1</div>
    </section>
  </main>

  <script>
    const state = {
      players: [],
      running: false,
      currentIndex: -1,
      round: 1,
      idSeq: 1,
    };
    const $ = sel => document.querySelector(sel);

    function render(){
      const list = $('#playerList');
      list.innerHTML = '';
      if(state.players.length === 0){
        $('#emptyState').style.display = 'block';
      } else {
        $('#emptyState').style.display = 'none';
      }

      state.players.forEach((p, idx) => {
        const li = document.createElement('li');
        li.className = 'player' + (idx === state.currentIndex && state.running ? ' current' : '');
        li.draggable = true;
        li.addEventListener('dragstart', e => {
          e.dataTransfer.setData('id', p.id);
        });
        li.addEventListener('dragover', e => { e.preventDefault(); });
        li.addEventListener('drop', e => {
          e.preventDefault();
          const draggedId = parseInt(e.dataTransfer.getData('id'));
          const fromIdx = state.players.findIndex(pp => pp.id === draggedId);
          const toIdx = idx;
          const [moved] = state.players.splice(fromIdx,1);
          state.players.splice(toIdx,0,moved);
          render();
        });

        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.className = 'name-input';
        nameInput.value = p.name;
        nameInput.addEventListener('change', ()=>{ p.name = nameInput.value; });

        const initDisplay = document.createElement('span');
        initDisplay.className = 'initiative-display';
        initDisplay.textContent = p.init !== null ? `Init: ${p.init}` : 'Init: -';

        const initInput = document.createElement('input');
        initInput.type = 'number';
        initInput.value = p.init ?? '';
        initInput.style.width = '60px';
        initInput.addEventListener('change', ()=>{
          p.init = parseInt(initInput.value);
          if(state.running){
            resortPlayers();
          }
          render();
        });

        const hpControl = document.createElement('div');
        hpControl.className = 'hp-control';
        const hpInput = document.createElement('input');
        hpInput.type = 'number';
        hpInput.value = p.hp ?? 10;
        hpInput.addEventListener('change', ()=>{ p.hp = parseInt(hpInput.value); });
        hpControl.append('HP:', hpInput);

        const condControl = document.createElement('div');
        condControl.className = 'cond-control';
        if(p.conditions){
          p.conditions.forEach(c => {
            const tag = document.createElement('span');
            tag.className='cond-tag';
            tag.textContent=c;
            condControl.append(tag);
          });
        }
        const condInput=document.createElement('input');
        condInput.placeholder='Condição';
        condInput.className='cond-input';
        condInput.addEventListener('keydown', e=>{
          if(e.key==='Enter' && condInput.value.trim()!==''){
            p.conditions.push(condInput.value.trim());
            condInput.value='';
            render();
          }
        });
        condControl.append(condInput);

        const removeBtn = document.createElement('button');
        removeBtn.textContent='X';
        removeBtn.addEventListener('click',()=>{ removePlayer(p.id); });

        li.append(nameInput, initDisplay, initInput, hpControl, condControl, removeBtn);
        list.append(li);
      });

      $('#btnStart').disabled = state.running || state.players.length===0;
      $('#btnNext').disabled = !state.running;
      $('#btnEnd').disabled = !state.running;
      $('#btnResort').disabled = !state.running;

      if(state.running){
        $('#roundIndicator').style.display='block';
        $('#roundIndicator').textContent = 'Rodada ' + state.round;
      } else {
        $('#roundIndicator').style.display='none';
      }
    }

    function addPlayer(name, init){
      if(!name) return;
      state.players.push({ id: state.idSeq++, name: name.trim(), init: init===''?null:Number(init), hp:10, conditions:[] });
      render();
    }
    function removePlayer(id){
      state.players = state.players.filter(p=>p.id!==id);
      if(state.players.length===0) endCombat();
      render();
    }
    function resortPlayers(){
      state.players.sort((a,b)=> (b.init||0) - (a.init||0));
    }
    function startCombat(){
      resortPlayers();
      state.running=true; state.currentIndex=0; state.round=1; render();
    }
    function nextTurn(){
      if(!state.running) return;
      state.currentIndex=(state.currentIndex+1)%state.players.length;
      if(state.currentIndex===0) state.round++;
      render();
    }
    function endCombat(){
      state.running=false; state.currentIndex=-1; state.round=1; render();
    }

    $('#btnAdd').addEventListener('click',()=>{
      addPlayer($('#name').value,$('#init').value);
      $('#name').value='';$('#init').value='';
    });
    $('#btnStart').addEventListener('click',startCombat);
    $('#btnNext').addEventListener('click',nextTurn);
    $('#btnEnd').addEventListener('click',endCombat);
    $('#btnResort').addEventListener('click',()=>{ resortPlayers(); render(); });
    render();
  </script>
</body>
</html>
